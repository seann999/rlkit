version: 0
os: ubuntu==16.04
features:
- apt:libopenblas-dev
- apt:gfortran
- apt:python3-scipy
- apt:wget
- apt:unzip
- apt:libgl1-mesa-dev
- apt:libgl1-mesa-glx
- apt:libxrandr-dev
- apt:libglew-dev
- apt:libosmesa6-dev
- apt:libxinerama-dev
- apt:libxi-dev
- apt:libxcursor-dev
- apt:cmake
- cuda==9.0
- cudnn==7.1.2
- cupy==4.3.0
- chainer==4.3.1
- python==3
- custom:chainerrl
- custom:mujoco150
- pip:gym[atari,mujoco]==0.10.5
- custom:gym-box2d
- custom:roboschool
- pip:PyOpenGL-accelerate==3.1.0
- opencv==3.2.0
- pip:matplotlib==2.0.2
- pip:torch==1.0.1
- pip:joblib==0.9.4
- pip:lockfile==0.12.2
- pip:mako==1.0.6
- pip:cloudpickle==0.5.2
- pip:tensorflow==1.12.0
- pip:jsonmerge==1.5.2
- pip:gtimer==1.0.0b5
- pip:pygame==1.9.2
custom_defs:
  gym-box2d:
    # https://github.com/openai/gym/issues/100
    commands: |
      ln -s /usr/bin/swig3.0 /usr/bin/swig
      git clone https://github.com/pybox2d/pybox2d
      cd pybox2d
      python3 setup.py build
      python3 setup.py install
      cd ..
    dependencies:
    - apt:swig3.0
  roboschool:
    commands: |
      git clone https://github.com/openai/roboschool.git
      cd roboschool
      git clone https://github.com/olegklimov/bullet3 -b roboschool_self_collision
      mkdir bullet3/build
      cd    bullet3/build
      cmake -DBUILD_SHARED_LIBS=ON -DUSE_DOUBLE_PRECISION=1 -DCMAKE_INSTALL_PREFIX:PATH=../../roboschool/cpp-household/bullet_local_install -DBUILD_CPU_DEMOS=OFF -DBUILD_BULLET2_DEMOS=OFF -DBUILD_EXTRAS=OFF  -DBUILD_UNIT_TESTS=OFF -DBUILD_CLSOCKET=OFF -DBUILD_ENET=OFF -DBUILD_OPENGL3_DEMOS=OFF ..
      make
      make install
      cd ../..
      pip3 install -e .
      cd ..
    dependencies:
    - apt:ffmpeg
    - apt:pkg-config
    - apt:qtbase5-dev
    - apt:libqt5opengl5-dev
    - apt:libassimp-dev
    - apt:libpython3.5-dev
    - apt:libboost-python-dev
    - apt:libtinyxml-dev
  chainerrl:
    commands: |
      pip3 install git+git://github.com/chainer/chainerrl.git@bad57aa02bc7fd77bb91e019206afa12c3b52505
  patchelf:
    commands: |
      # https://github.com/openai/mujoco-py/issues/147
      add-apt-repository ppa:jamesh/snap-support
      apt-get update
      apt install patchelf
    dependencies:
    # software-properties-common is necessary for add-apt-repository
    - apt:software-properties-common
  mujoco150:
    # Put mjkey.txt at /mjkey/mjkey.txt
    commands: |
      wget https://www.roboti.us/download/mjpro150_linux.zip
      mkdir /home/user/.mujoco
      unzip mjpro150_linux.zip -d /home/user/.mujoco
      ln -s /mjkey/mjkey.txt /home/user/.mujoco/mjkey.txt
      chown -R user /home/user/.mujoco
      rm mjpro150_linux.zip
      # Files are generated under mujoco_py/generated when imported.
      # mujoco_py is installed by root while the user command is executed by
      # user, so it will raise an permission error without chown here.
      chown -R user /usr/local/lib/python3.5/dist-packages/mujoco_py/generated
    dependencies:
    - pip:mujoco_py==1.50.1.56
    - custom:patchelf
datasets:
  - mjkey==1 @ /mjkey
hardware:
- cpu==1
- gpu==1
- ram==10000
- disk==10000
buildcmd:
  pwd && ls -al